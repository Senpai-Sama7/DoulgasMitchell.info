version: 1
advanced_indexing: true
hybrid_search:
  dense_embeddings:
    model: text-embedding-3-large
    max_chunk_tokens: 1200
    overlap_tokens: 120
    preserve_code_fences: true
    preserve_headings: true
  sparse_retrieval:
    method: bm25
    boost:
      heading_weight: 2.0
      codeblock_weight: 2.5
      api_table_weight: 1.8
ranking:
  gold_weight: 1.0
  silver_weight: 0.55
  freshness_half_life_days: 120
  prefer_versioned_docs: true
  conflict_resolution:
    order: [gold, newest_versioned, newest_unversioned]
metadata_capture:
  fields: [product, version, language, api_surface, stability_tag, last_modified, source_tier]
indexes:
  - name: gold
    tier: gold
    mode: specific_urls_only
    discovery: disabled
    recrawl:
      policy: interval
      interval_days: 30
      change_detection: etag_or_lastmod
    image_search:
      enabled: true
      restrict_filetypes: [svg, png]
    sitemaps:
      - docs.python.org/sitemap.xml
      - react.dev/sitemap.xml
      - kubernetes.io/sitemap.xml
      - docs.aws.amazon.com/sitemap.xml
      - pytorch.org/sitemap.xml
    include_patterns:
      - developer.mozilla.org/*
      - html.spec.whatwg.org/*
      - tc39.es/*
      - www.w3.org/TR/*
      - httpwg.org/*

      - docs.python.org/*
      - peps.python.org/*
      - pandas.pydata.org/docs/*
      - numpy.org/doc/*
      - docs.scipy.org/doc/*
      - scikit-learn.org/stable/*
      - docs.pydantic.dev/*
      - docs.pytest.org/*
      - fastapi.tiangolo.com/*
      - docs.djangoproject.com/*
      - flask.palletsprojects.com/*
      - huggingface.co/docs/*

      - www.typescriptlang.org/docs/*
      - nodejs.org/api/*
      - react.dev/*
      - react.dev/reference/*
      - nextjs.org/docs/*
      - remix.run/docs/*
      - vuejs.org/guide/*
      - nuxt.com/docs/*
      - angular.io/docs/*
      - svelte.dev/docs/*
      - vitejs.dev/guide/*

      - en.cppreference.com/w/*
      - doc.rust-lang.org/*
      - rust-lang.github.io/*
      - go.dev/doc/*
      - pkg.go.dev/*
      - kotlinlang.org/docs/*
      - docs.oracle.com/en/java/*
      - learn.microsoft.com/dotnet/*

      - cmake.org/cmake/help/latest/*
      - bazel.build/docs/*
      - docs.docker.com/*
      - kubernetes.io/docs/*
      - docs.github.com/*
      - git-scm.com/docs/*
      - pip.pypa.io/*
      - python-poetry.org/docs/*
      - docs.npmjs.com/*
      - pnpm.io/*
      - docs.renovatebot.com/*
      - docs.sonarsource.com/*

      - www.postgresql.org/docs/*
      - dev.mysql.com/doc/*
      - www.sqlite.org/docs.html
      - www.mongodb.com/docs/*
      - redis.io/docs/*
      - www.elastic.co/guide/*
      - clickhouse.com/docs/*
      - www.timescale.com/docs/*

      - docs.aws.amazon.com/*
      - cloud.google.com/docs/*
      - cloud.google.com/bigquery/docs/*
      - cloud.google.com/compute/docs/*
      - cloud.google.com/storage/docs/*
      - cloud.google.com/kubernetes-engine/docs/*
      - cloud.google.com/run/docs/*
      - cloud.google.com/functions/docs/*
      - cloud.google.com/iam/docs/*
      - cloud.google.com/spanner/docs/*
      - cloud.google.com/pubsub/docs/*
      - learn.microsoft.com/azure/*
      - registry.terraform.io/providers/*/latest/docs/*
      - developer.hashicorp.com/terraform/docs/*

      - pytorch.org/docs/*
      - www.tensorflow.org/api_docs/*
      - lightning.ai/docs/*
      - platform.openai.com/docs/*
      - docs.anthropic.com/*
      - cohere.com/docs/*
      - python.langchain.com/docs/*
      - langchain.readthedocs.io/*
      - lancedb.com/docs/*
      - weaviate.io/developers/*
      - www.pinecone.io/docs/*
      - milvus.io/docs/*
      - qdrant.tech/documentation/*

      - cwe.mitre.org/data/*
      - nvd.nist.gov/*
      - owasp.org/www-project-top-ten/*
      - cheatsheetseries.owasp.org/*
      - prometheus.io/docs/*
      - grafana.com/docs/*
      - docs.sentry.io/*

      - datatracker.ietf.org/doc/html/*
      - swagger.io/specification/*
      - graphql.org/learn/*

      - man7.org/linux/man-pages/*
      - www.gnu.org/software/bash/manual/*
      - tldp.org/HOWTO/*

      - spdx.org/licenses/*
      - choosealicense.com/licenses/*

      - docs.nvidia.com/*
      - intel.github.io/*
      - www.agner.org/optimize/*

      - jestjs.io/docs/*
      - vitest.dev/guide/*
      - playwright.dev/docs/*
      - docs.cypress.io/*
    exclude_and_rank:
      exclude:
        - "*/blog/*"
        - "*/community/*"
        - "*/forum/*"
      downrank:
        - "*/release-notes/*"
        - "*/changelogs/*"
        - "*/api/changelog/*"
      silver_only:
        - "*/tutorials/*"

  - name: silver
    tier: silver
    mode: specific_urls_plus_known
    discovery: enabled
    recrawl:
      policy: interval
      interval_days: 14
      change_detection: etag_or_lastmod
    image_search:
      enabled: true
      restrict_filetypes: [svg, png]
    include_patterns:
      - stackoverflow.com/questions/*
      - superuser.com/questions/*
      - serverfault.com/questions/*

      - discuss.python.org/*
      - internals.python.org/*

      - github.com/*/*/discussions/*
      - github.com/pytorch/*/issues/*
      - github.com/tensorflow/*/issues/*
      - github.com/vercel/*/issues/*
      - github.com/kubernetes/*/issues/*

      - dev.to/*
      - medium.com/*

      - react.dev/learn/*
      - kubernetes.io/docs/concepts/*
      - docs.aws.amazon.com/*
      - pytorch.org/docs/*

      - nodejs.org/api/errors.html
      - docs.docker.com/engine/reference/run/*
      - kubernetes.io/docs/reference/*
    exclude_and_rank:
      exclude: []
      downrank:
        - "*/release-notes/*"
        - "*/changelogs/*"
        - "*/api/changelog/*"

routing:
  strategy: prefer_gold_then_silver
  answer_synthesis:
    cite_gold_first: true
    max_snippets_per_source: 4
    max_total_snippets: 12
push_api:
  enabled: true
  dedupe_by: canonical_url
  on_push:
    - immediate_index_refresh: true
observability:
  metrics:
    enabled: true
    export: prometheus
  tracing:
    enabled: true
    sampler: parentbased_traceidratio
    ratio: 0.1
guardrails:
  allowlist_only_for_gold: true
  pii_scrub:
    enabled: true
    patterns: [email, phone, ip, key, secret]
  license_awareness:
    enabled: true
    sources: [spdx, choosealicense]
